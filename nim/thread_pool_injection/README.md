# Nim PoolParty

Thread pool process injection writen in Nim. This is from research from [SafeBreach Labs](https://www.safebreach.com/blog/process-injection-using-windows-thread-pools) with their technique title [PoolParty](https://github.com/SafeBreach-Labs/PoolParty).

This code is ported from [Uri3n's](https://github.com/Uri3n/) [Thread-Pool-Injection-Poc](https://github.com/Uri3n/Thread-Pool-Injection-PoC/tree/main?tab=readme-ov-file). Uri3n has an extremely digestiable [write-up](https://urien.gitbook.io/diago-lima/a-deep-dive-into-exploiting-windows-thread-pools) concerning this technique that deserves a read.

### Compile

Compile with whatever options you see fit: `nim c -d:release main.nim`

### Usage
```
Pool Party Injection in Nim:
  Example Usage: ./main.exe -t workerfactory -s startroutine

Usage:
   [options]

Options:
  -h, --help
  -p, --pid=PID              PID of the target process to inject
  -t, --type=TYPE            Type of pool injection. Possible values: [ioport, timer, workerfactory]
  -s, --subtype=SUBTYPE      Subtype of the pool injection. [workerfactory: work, startroutine] [ioport: wait, jobobject, alpc, direct] [timer: tptimer]
                             Possible values: [work, startroutine, wait, jobobject, alpc, direct, tptimer]
```

### Shellcode

It is worth noting that the original PoC used an infinite loop (`ebfe`) at the end of the shellcode for CoE. 

### Credit 
* LinkedIn - [Alon Leviev](https://il.linkedin.com/in/alonleviev)
* Twitter - [@_0xDeku](https://twitter.com/_0xDeku)
* Github - [Uri3n](https://github.com/Uri3n)
* [MalDev Academy](maldevacademy.com)  

### TODO
- [] Document Procedure Usage